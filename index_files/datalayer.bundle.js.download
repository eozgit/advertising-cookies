webpackJsonp([33],{380:function(e,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var c={pushToDataLayer:function(e){window.dataLayer=window.dataLayer||[],window.dataLayer.push(e)},product:{addCheckoutData:function(e,a){null==a&&(a={}),a.ecommerce=a.ecommerce||{},a.ecommerce.checkout=a.ecommerce.checkout||{},a.ecommerce.checkout.products=a.ecommerce.checkout.products||[];var t=a.ecommerce.checkout.products.length+1;return e.cartItems.forEach(function(e){a.ecommerce.checkout.products.push(c.product.createProductDetail(e.product,e.quantity,t,e)),t+=1}),a},addCheckoutConfirmationData:function(e,a){null==a&&(a={}),a.ecommerce=a.ecommerce||{},a.ecommerce.purchase=a.ecommerce.purchase||{},a.ecommerce.purchase.actionField=c.product.createConfirmationDetail(e),a.ecommerce.purchase.products=a.ecommerce.purchase.products||[];var t=a.ecommerce.purchase.products.length;return e.orderLines.forEach(function(e){a.ecommerce.purchase.products.push(c.product.createProductDetail(e.product,e.quantity,t,e)),t+=1}),a},addReservationConfirmationData:function(e,a){null==a&&(a={}),a.ecommerce=a.ecommerce||{},a.ecommerce.purchase=a.ecommerce.purchase||{},a.ecommerce.purchase.actionField=c.product.createReservationConfirmationDetail(e),a.ecommerce.purchase.products=a.ecommerce.purchase.products||[];var t=a.ecommerce.purchase.products.length;return e.reservationLines.forEach(function(e){a.ecommerce.purchase.products.push(c.product.createProductDetail(e.sku.product,e.quantity,t,e,!0)),t+=1}),a},addSubscriptionConfirmationData:function(e,a){return null==a&&(a={}),a.ecommerce=a.ecommerce||{},a.ecommerce.purchase=a.ecommerce.purchase||{},a.ecommerce.purchase.actionField=e.subActionFields,a.ecommerce.purchase.products=a.ecommerce.purchase.products||[],a.ecommerce.purchase.products.push(e.subProducts),a},addProductData:function(e,a,t){var o={};o.ecommerce={},o.ecommerce.detail={},o.ecommerce.detail.products=[],o.ecommerce.detail.products.push(c.product.createProductDetail(e,a,t)),c.pushToDataLayer(o)},createProductDetail:function(e,a,t,c,o){var r={},i=null,n=null;if(e.pricesCurrent){var u=(e.pricesCurrent.prices.basePrice-e.pricesCurrent.prices.multibuyPrice).toFixed(2);n=u>0?"Save £"+u:"No Saving",i=e.pricesCurrent.prices.multibuyPrice.toFixed(2),o&&(i=(e.pricesCurrent.prices.multibuyPrice*e.pricesCurrent.foreignCurrencyExchangeRates[0].exchangeRate).toFixed(2))}else if(c&&c.prices){var d=(c.prices.list-c.prices.sale).toFixed(2);n=d>0?"Save £"+d:"No Saving",i=c.prices.sale.toFixed(2)}r.name=e.productName,r.id=e.productCode,i&&(r.price=i),"Non Wine - Electronic"!==e.productTypeDesc?r.brand=e.grapeDescription:r.brand=window.storeName,r.category=e.productCode.substring(0,2),r.variant=e.productStyleDesc,t&&(r.position=t-1),n&&(r.dimension3=n);var s=e.productFamily.allRatings>0?Math.round(e.productFamily.positiveRatings/e.productFamily.allRatings*100):0,p=s+"%";return r.dimension4=p,r.dimension5=e.productFamily.allRatings.toString(),a>0?(r.dimension9="Yes",r.quantity=a):e.availability&&e.availability.canAddToCart?r.dimension9="Yes":r.dimension9="No",r},createConfirmationDetail:function(e){var a={};return a.id=e.id,a.affiliation="Majestic",a.revenue=e.totalPrice,a.tax=e.totalSalesTax,a.shipping=e.shippingPrice,void 0!==e.voucher&&void 0!==e.voucher.code&&(a.coupon=e.voucher.code),e.shipments.length>0&&e.shipments[0].shipmentMethod&&(a.dimension7=e.shipments[0].shipmentMethod.description),a.dimension13=e.giftMessage&&e.giftMessage.length>0,a.dimension14=e.orderLines.filter(function(e){return 1==e.product.signup}).length>0?"True":"False",a},createReservationConfirmationDetail:function(e){var a={};return a.id=e.id,a.affiliation="Majestic",a.revenue=(e.totalPrice*e.euroToPound.exchangeRate).toFixed(2),a.tax=0,a.shipping=-1*e.discount,a},addSearchResultAssortmentData:function(e,a){var t=e.objects.map(function(e){return e.object});return c.product.addSearchResultData(t,a)},addSearchResultData:function(e,a){var t={},o=1,r=1;a?(t.ecommerce={},t.ecommerce.impressions=[]):(t.ecommerce=window.dataLayer.ecommerce||{},t.ecommerce.impressions=window.dataLayer.impressions||[],o=t.ecommerce.impressions.length),e.forEach(function(e,a){t.ecommerce.impressions.push(c.product.createProductDetail(e,0,o)),o+=1,(a+1)%6==0&&(c.page.addEvent("plpImpressions"+r,t),c.pushToDataLayer(t),r++,t={},t.ecommerce={},t.ecommerce.impressions=[])}),c.page.addEvent("plpImpressions"+r,t),c.pushToDataLayer(t)}},stores:{addStoreWallData:function(e,a){var t={};t.storeName=a,t.type=e,c.page.addEvent("storeLike",t),c.pushToDataLayer(t)}},homepage:{addHomepageSurveyData:function(e,a,t){var o={};o.question=a,o.step=e,o.option=t,c.page.addEvent("hpQuestionnaire",o),c.pushToDataLayer(o)}},wineify:{addWineifySurveyData:function(e,a,t){var o={};o.question=a,o.step=e,o.option=t,c.page.addEvent("wineify",o),c.pushToDataLayer(o)}},page:{addPageName:function(e){window.dataLayer=window.dataLayer||[],window.dataLayer[0].pageName=e},addGlobalPageData:function(e){c.pushToDataLayer(e)},addEvent:function(e,a){return null==a&&(a={}),a.event=e,a},addNewExisting:function(e,a){return null==a&&(a={}),a.newExisting=e,a},addCheckoutStep:function(e,a){return null==a&&(a={}),a.ecommerce=a.ecommerce||{},a.ecommerce.checkout=a.ecommerce.checkout||{},a.ecommerce.checkout.actionField={},a.ecommerce.checkout.actionField.step=e,a}},api:{pageLoad:{basket:function(e){var a={};c.page.addPageName("Basket"),c.page.addCheckoutStep(1,a),c.page.addEvent("checkout",a),c.product.addCheckoutData(e,a),c.pushToDataLayer(a)},checkout:function(e){var a={};c.page.addPageName("Checkout"),c.page.addCheckoutStep(2,a),c.page.addEvent("checkout",a),c.product.addCheckoutData(e,a),c.pushToDataLayer(a)},orderConfirmation:function(e){var a={};c.page.addPageName("Checkout"),c.page.addEvent("transaction",a),c.page.addNewExisting(newCustomer,a),c.product.addCheckoutConfirmationData(e,a),c.pushToDataLayer(a)},reservationConfirmation:function(e){var a={};console.log(e),c.page.addPageName("Checkout"),c.page.addEvent("transaction",a),c.product.addReservationConfirmationData(e,a),c.pushToDataLayer(a)},subscriptionConfirmation:function(e,a,t){var o={},r=t.productFamily.allRatings>0?Math.round(t.productFamily.positiveRatings/t.productFamily.allRatings*100):0,i=r+"%",n=null;if(t.pricesCurrent){var u=(t.pricesCurrent.prices.multibuyPrice-e.setPrice).toFixed(2);n=u>0?"Save £"+u:"No Saving"}var d={subActionFields:{id:e.id,revenue:a,action:"purchase",affiliation:"Majestic",coupon:null,shipping:0,tax:0},subProducts:{id:t.productCode,name:t.productName,brand:t.grapeDescription,category:t.productCode.substring(0,2),price:e.setPrice,quantity:e.quantity,variant:t.productStyleDesc,dimension3:n,dimension4:i,dimension5:t.productFamily.allRatings.toString(),dimension9:"Yes",dimension10:e.frequency}};c.page.addPageName("Checkout"),c.page.addEvent("transaction",o),c.product.addSubscriptionConfirmationData(d,o),c.pushToDataLayer(o)},pdp:function(){},plp:function(){}}}};readyFunctions.push(function(){$.subscribe("product-added",function(e,a){var t={};t.ecommerce={},t.ecommerce.add={},t.ecommerce.add.products=[],t.ecommerce.add.products.push(c.product.createProductDetail(a.product,a.quantity,a.position)),c.page.addEvent("addToCart",t),c.pushToDataLayer(t)}),$.subscribe("product-removed",function(e,a){var t={};t.ecommerce={},t.ecommerce.remove={},t.ecommerce.remove.products=[],t.ecommerce.remove.products.push(a),c.page.addEvent("removeFromCart",t),c.pushToDataLayer(t)}),$.subscribe("checkout-register",function(e,a){var t={};c.page.addCheckoutStep(2,t),c.page.addEvent("checkout",t),c.pushToDataLayer(t)}),$.subscribe("checkout-add-address",function(e,a){var t={};c.page.addCheckoutStep(3,t),c.page.addEvent("checkout",t),c.pushToDataLayer(t)}),$.subscribe("checkout-add-click-n-collect",function(e,a){var t={};c.page.addCheckoutStep(3,t),c.page.addEvent("checkout",t),c.pushToDataLayer(t)}),$.subscribe("checkout-add-card",function(e,a){var t={};c.page.addCheckoutStep(4,t),c.page.addEvent("checkout",t),c.pushToDataLayer(t)}),$.subscribe("checkout-paypal-selected",function(e,a){var t={};c.page.addCheckoutStep(4,t),c.page.addEvent("checkout",t),c.pushToDataLayer(t)}),$.subscribe("checkout-buy-now",function(e,a){var t={};c.page.addCheckoutStep(5,t),c.page.addEvent("checkout",t),c.pushToDataLayer(t)}),$.subscribe("store-searched",function(e,a){var t={};t.storeSearchTerm=a,c.page.addEvent("storeSearch",t),c.pushToDataLayer(t)}),$.subscribe("wall-post-created",function(e,a){c.stores.addStoreWallData("post",a)}),$.subscribe("wall-post-edited",function(e,a){c.stores.addStoreWallData("edit",a)}),$.subscribe("wall-post-pinned",function(e,a){c.stores.addStoreWallData("pin",a)}),$.subscribe("wall-post-liked",function(e,a){c.stores.addStoreWallData("like",a)}),$.subscribe("wall-post-unliked",function(e,a){c.stores.addStoreWallData("unlike",a)}),$.subscribe("wall-post-replied",function(e,a){c.stores.addStoreWallData("reply",a)}),$.subscribe("wall-post-spam",function(e,a){c.stores.addStoreWallData("spamReport",a)})}),window.MajesticDataLayer=c,a.default=c}},[380]);
//# sourceMappingURL=datalayer.bundle.js.map